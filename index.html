<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src * blob: data: 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; frame-src *; style-src * 'unsafe-inline';">
    <title>Telegram Clicker Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            text-align: center;
        }
        
        h1 {
            margin: 20px 0;
            color: var(--tg-theme-text-color, #000000);
        }
        
        #score {
            font-size: 48px;
            font-weight: bold;
            margin: 30px 0;
            color: var(--tg-theme-button-color, #2481cc);
        }
        
        .click-btn {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            font-size: 24px;
            cursor: pointer;
            margin: 20px;
            transition: all 0.1s;
        }
        
        .click-btn:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }
        
        .stat-item {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            margin: 0 10px;
        }
        
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Telegram Clicker</h1>
        
        <div id="score">0</div>
        <button class="click-btn" onclick="handleClick()">TAP</button>
        
        <div class="stats">
            <div class="stat-item">
                <div>‚ö°Ô∏è CPS</div>
                <div id="cps">1</div>
            </div>
            <div class="stat-item">
                <div>üí∞ –í—Å–µ–≥–æ</div>
                <div id="total">0</div>
            </div>
        </div>
        
        <div class="status" id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="status" id="userInfo"></div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        
        // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.expand();
        tg.enableClosingConfirmation();
        
        let score = 0;
        let cps = 1;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            const user = tg.initDataUnsafe.user;
            document.getElementById('userInfo').innerHTML = 
                `üë§ –ò–≥—Ä–æ–∫: ${user.first_name} ${user.last_name || ''}`;
        }
        
        function handleClick() {
            score += cps;
            updateDisplay();
            
            // –í–∏–±—Ä–∞—Ü–∏—è
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
            sendToBackend();
        }
        
        function updateDisplay() {
            document.getElementById('score').textContent = formatNumber(score);
            document.getElementById('cps').textContent = cps;
            document.getElementById('total').textContent = formatNumber(score);
        }
        
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num;
        }
        
        // –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
        setInterval(() => {
            score += cps;
            updateDisplay();
        }, 1000);
        
        // –£–ª—É—á—à–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            cps += 1;
            updateDisplay();
        }, 10000);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–µ–Ω–¥–∞
        async function checkBackend() {
            const backendUrl = "https://clicker6666-back-production.up.railway.app";
            
            try {
                const response = await fetch(`${backendUrl}/api/health`);
                if (response.ok) {
                    document.getElementById('status').textContent = '‚úÖ –°–µ—Ä–≤–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω';
                    document.getElementById('status').style.background = '#d4edda';
                } else {
                    throw new Error('Server error');
                }
            } catch (error) {
                document.getElementById('status').textContent = '‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–∏–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ)';
                document.getElementById('status').style.background = '#fff3cd';
            }
        }
        
        async function sendToBackend() {
            // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            const backendUrl = "https://clicker6666-back-production.up.railway.app";
            
            try {
                await fetch(`${backendUrl}/api/click`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        action: 'click',
                        score: score,
                        timestamp: Date.now()
                    })
                });
            } catch (error) {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.ready();
        updateDisplay();
        checkBackend();
        
        console.log('Telegram Web App initialized:', tg);
        console.log('User data:', tg.initDataUnsafe.user);
    </script>
</body>
</html>
